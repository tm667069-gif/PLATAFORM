-- Proteção para reaparecer após morte (sem funções de ragdoll)
local player = game.Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")

local function criarGUI()
    -- Remover GUI antiga se existir
    if player:FindFirstChild("PlayerGui") and player.PlayerGui:FindFirstChild("APELUDO_HUB_GUI") then
        player.PlayerGui.APELUDO_HUB_GUI:Destroy()
    end

    --// Criar ScreenGui principal
    local gui = Instance.new("ScreenGui")
    gui.Name = "APELUDO_HUB_GUI"
    gui.Parent = player.PlayerGui

    --// Bola Fixa (não arrastável)
    local bolaBtn = Instance.new("Frame")
    bolaBtn.Size = UDim2.new(0, 60, 0, 60)
    bolaBtn.Position = UDim2.new(0.1, 0, 0.1, 0)
    bolaBtn.BackgroundColor3 = Color3.new(0,0,0)
    bolaBtn.BackgroundTransparency = 0
    bolaBtn.BorderSizePixel = 0
    bolaBtn.Name = "BolaApeludo"
    bolaBtn.Parent = gui
    bolaBtn.ClipsDescendants = true

    -- Deixa o frame redondo
    local uicorner = Instance.new("UICorner")
    uicorner.CornerRadius = UDim.new(1,0)
    uicorner.Parent = bolaBtn

    local bolaBtnLabel = Instance.new("TextLabel")
    bolaBtnLabel.Size = UDim2.new(1,0,1,0)
    bolaBtnLabel.Position = UDim2.new(0,0,0,0)
    bolaBtnLabel.BackgroundTransparency = 1
    bolaBtnLabel.Text = "APELUDO HUB"
    bolaBtnLabel.TextColor3 = Color3.fromRGB(255,255,255)
    bolaBtnLabel.TextScaled = true
    bolaBtnLabel.Font = Enum.Font.GothamBold
    bolaBtnLabel.Parent = bolaBtn

    -- Botão invisível para clicar em cima da bola
    local clickBtn = Instance.new("TextButton")
    clickBtn.Size = UDim2.new(1,0,1,0)
    clickBtn.Position = UDim2.new(0,0,0,0)
    clickBtn.BackgroundTransparency = 1
    clickBtn.Text = ""
    clickBtn.Parent = bolaBtn
    clickBtn.ZIndex = 10

    --// GUI "apelao" (inicialmente invisível)
    local apelaoFrame = Instance.new("Frame")
    apelaoFrame.Size = UDim2.new(0, 220, 0, 180)
    apelaoFrame.Position = UDim2.new(0.5, -110, 0.5, -90)
    apelaoFrame.BackgroundColor3 = Color3.fromRGB(40,40,40)
    apelaoFrame.Visible = false
    apelaoFrame.Parent = gui
    apelaoFrame.Name = "apelao"

    local titulo = Instance.new("TextLabel")
    titulo.Size = UDim2.new(1,0,0.14,0)
    titulo.Position = UDim2.new(0,0,0,0)
    titulo.BackgroundTransparency = 1
    titulo.Text = "GUI APELAO"
    titulo.TextColor3 = Color3.fromRGB(255,255,127)
    titulo.TextScaled = true
    titulo.Parent = apelaoFrame

    -- Botão de voo (Ativar / Desativar)
    local botao = Instance.new("TextButton")
    botao.Size = UDim2.new(0.8,0,0.14,0)
    botao.Position = UDim2.new(0.1,0,0.16,0)
    botao.Text = "Ativar"
    botao.BackgroundColor3 = Color3.fromRGB(0,170,0)
    botao.TextColor3 = Color3.new(1,1,1)
    botao.TextScaled = true
    botao.Parent = apelaoFrame

    -- ====== Botão Velocidade + painel ======
    local botaoVel = Instance.new("TextButton")
    botaoVel.Size = UDim2.new(0.8,0,0.14,0)
    botaoVel.Position = UDim2.new(0.1,0,0.34,0)
    botaoVel.Text = "Velocidade"
    botaoVel.BackgroundColor3 = Color3.fromRGB(120,120,120)
    botaoVel.TextColor3 = Color3.new(1,1,1)
    botaoVel.TextScaled = true
    botaoVel.Parent = apelaoFrame

    -- Painel que controla a velocidade (inicialmente invisível)
    local velPanel = Instance.new("Frame")
    velPanel.Size = UDim2.new(0.9,0,0.4,0)
    velPanel.Position = UDim2.new(0.05,0,0.52,0)
    velPanel.BackgroundColor3 = Color3.fromRGB(50,50,50)
    velPanel.Visible = false
    velPanel.Parent = apelaoFrame

    local velTitle = Instance.new("TextLabel")
    velTitle.Size = UDim2.new(1,0,0.2,0)
    velTitle.Position = UDim2.new(0,0,0,0)
    velTitle.BackgroundTransparency = 1
    velTitle.Text = "Velocidade de Voo"
    velTitle.TextColor3 = Color3.fromRGB(255,255,255)
    velTitle.TextScaled = true
    velTitle.Parent = velPanel

    local velDisplay = Instance.new("TextLabel")
    velDisplay.Size = UDim2.new(0.45,0,0.28,0)
    velDisplay.Position = UDim2.new(0.025,0,0.28,0)
    velDisplay.BackgroundColor3 = Color3.fromRGB(70,70,70)
    velDisplay.TextColor3 = Color3.new(1,1,1)
    velDisplay.TextScaled = true
    velDisplay.Parent = velPanel

    local velMinus = Instance.new("TextButton")
    velMinus.Size = UDim2.new(0.2,0,0.28,0)
    velMinus.Position = UDim2.new(0.5,0,0.28,0)
    velMinus.Text = "-"
    velMinus.TextScaled = true
    velMinus.BackgroundColor3 = Color3.fromRGB(150,50,50)
    velMinus.Parent = velPanel

    local velPlus = Instance.new("TextButton")
    velPlus.Size = UDim2.new(0.2,0,0.28,0)
    velPlus.Position = UDim2.new(0.73,0,0.28,0)
    velPlus.Text = "+"
    velPlus.TextScaled = true
    velPlus.BackgroundColor3 = Color3.fromRGB(50,150,50)
    velPlus.Parent = velPanel

    local velTextBox = Instance.new("TextBox")
    velTextBox.Size = UDim2.new(0.9,0,0.24,0)
    velTextBox.Position = UDim2.new(0.05,0,0.64,0)
    velTextBox.PlaceholderText = "Digite a velocidade (ex: 50)"
    velTextBox.ClearTextOnFocus = false
    velTextBox.Text = ""
    velTextBox.TextScaled = true
    velTextBox.Parent = velPanel

    -- Clique na bola para abrir/fechar a GUI
    clickBtn.MouseButton1Click:Connect(function()
        apelaoFrame.Visible = not apelaoFrame.Visible
    end)

    --// Função de voo na direção da câmera
    local flying = false
    local bp, bg
    local SPEED = 50

    -- Funções para atualizar velocidade
    local function atualizarDisplay()
        velDisplay.Text = tostring(math.floor(SPEED))
    end

    local function setSpeed(n)
        if type(n) ~= "number" then return end
        if n < 10 then n = 10 end
        if n > 500 then n = 500 end
        SPEED = n
        atualizarDisplay()
    end

    -- Conexões do painel de velocidade
    botaoVel.MouseButton1Click:Connect(function()
        velPanel.Visible = not velPanel.Visible
    end)

    velPlus.MouseButton1Click:Connect(function()
        setSpeed(SPEED + 10)
    end)

    velMinus.MouseButton1Click:Connect(function()
        setSpeed(SPEED - 10)
    end)

    velTextBox.FocusLost:Connect(function(enterPressed)
        local v = tonumber(velTextBox.Text)
        if v then
            setSpeed(v)
        end
        velTextBox.Text = ""
    end)

    atualizarDisplay()

    local function startFly()
        local char = player.Character
        if not char or not char:FindFirstChild("HumanoidRootPart") then return end

        -- limpa instâncias antigas caso existam
        local hrp = char.HumanoidRootPart
        for _, inst in ipairs(hrp:GetChildren()) do
            if inst:IsA("BodyVelocity") or inst:IsA("BodyGyro") then
                inst:Destroy()
            end
        end

        bp = Instance.new("BodyVelocity")
        bp.MaxForce = Vector3.new(1e5, 1e5, 1e5)
        bp.Velocity = Vector3.new(0,0,0)
        bp.Parent = hrp

        bg = Instance.new("BodyGyro")
        -- caso queira que o personagem gire com a câmera, ajustar MaxTorque
        bg.MaxTorque = Vector3.new(0,0,0)
        bg.Parent = hrp

        flying = true
        spawn(function()
            while flying and bp and char and char:FindFirstChild("HumanoidRootPart") do
                local camera = workspace.CurrentCamera
                bp.Velocity = camera.CFrame.LookVector * SPEED
                wait(0.01)
            end
        end)
    end

    local function stopFly()
        flying = false
        local char = player.Character
        if char and char:FindFirstChild("HumanoidRootPart") then
            if char.HumanoidRootPart:FindFirstChildOfClass("BodyVelocity") then
                char.HumanoidRootPart:FindFirstChildOfClass("BodyVelocity"):Destroy()
            end
            if char.HumanoidRootPart:FindFirstChildOfClass("BodyGyro") then
                char.HumanoidRootPart:FindFirstChildOfClass("BodyGyro"):Destroy()
            end
        end
    end

    botao.MouseButton1Click:Connect(function()
        if not flying then
            startFly()
            botao.Text = "Desativar"
            botao.BackgroundColor3 = Color3.fromRGB(170,0,0)
        else
            stopFly()
            botao.Text = "Ativar"
            botao.BackgroundColor3 = Color3.fromRGB(0,170,0)
        end
    end)

    -- (Todas as funções de ragdoll/highlight foram removidas)
end

-- Criar GUI ao entrar no jogo
criarGUI()

-- Criar GUI toda vez que o personagem respawnar
player.CharacterAdded:Connect(function()
    wait(1)
    criarGUI()
end)
